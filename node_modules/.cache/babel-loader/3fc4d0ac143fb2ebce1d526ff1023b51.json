{"ast":null,"code":"import { toast } from \"react-toastify\";\nimport users from \"constants/api/users\";\nimport axios, { setAuthorizationHeader } from \"./index\";\nexport default function errorHandler(error) {\n  if (error) {\n    let message;\n\n    if (error.response) {\n      // console.log(error.response.status)\n      const originalRequest = error.config;\n      if (error.response.status === 500) message = \"Something went terribly wrong\";else if (error.response.status == 403 && !originalRequest._retry) {\n        originalRequest._retry = true;\n        const session = localStorage['BWAMICRO:token'] ? JSON.parse(localStorage['BWAMICRO:token']) : null;\n        console.log(error.response.status);\n        return users.refresh({\n          refresh_token: session.refresh_token,\n          email: session.email\n        }).then(res => {\n          console.log(\"ok\", res);\n\n          if (res.data) {\n            setAuthorizationHeader(res.data.token);\n            localStorage.setItem(\"BWAMICRO:token\", JSON.stringify({ ...session,\n              token: res.data.token\n            }));\n            originalRequest.header.authorization = res.data.token;\n            return axios(originalRequest);\n          } else {\n            window.location.href = \"/login\";\n            localStorage.removeItem(\"BWAMICRO:token\");\n          }\n        });\n      } else message = error.response.data.message;\n      if (typeof message === \"string\") toast.error(message);\n      return Promise.reject(error);\n    }\n  }\n}","map":{"version":3,"sources":["C:/xampp/htdocs/MICROSERVICE/FRONTEND/react-js/micro-memberpage/src/configs/axios/errorHandler.js"],"names":["toast","users","axios","setAuthorizationHeader","errorHandler","error","message","response","originalRequest","config","status","_retry","session","localStorage","JSON","parse","console","log","refresh","refresh_token","email","then","res","data","token","setItem","stringify","header","authorization","window","location","href","removeItem","Promise","reject"],"mappings":"AAAA,SAASA,KAAT,QAAsB,gBAAtB;AACA,OAAOC,KAAP,MAAkB,qBAAlB;AAEA,OAAOC,KAAP,IAAgBC,sBAAhB,QAA8C,SAA9C;AAEA,eAAe,SAASC,YAAT,CAAsBC,KAAtB,EAA6B;AAC1C,MAAIA,KAAJ,EAAW;AACT,QAAIC,OAAJ;;AACA,QAAID,KAAK,CAACE,QAAV,EAAoB;AAClB;AACA,YAAMC,eAAe,GAAGH,KAAK,CAACI,MAA9B;AACA,UAAIJ,KAAK,CAACE,QAAN,CAAeG,MAAf,KAA0B,GAA9B,EACEJ,OAAO,GAAG,+BAAV,CADF,KAEK,IAAID,KAAK,CAACE,QAAN,CAAeG,MAAf,IAAyB,GAAzB,IAAgC,CAACF,eAAe,CAACG,MAArD,EAA6D;AAChEH,QAAAA,eAAe,CAACG,MAAhB,GAAyB,IAAzB;AACA,cAAMC,OAAO,GAAGC,YAAY,CAAC,gBAAD,CAAZ,GAAiCC,IAAI,CAACC,KAAL,CAAWF,YAAY,CAAC,gBAAD,CAAvB,CAAjC,GAA8E,IAA9F;AACAG,QAAAA,OAAO,CAACC,GAAR,CAAYZ,KAAK,CAACE,QAAN,CAAeG,MAA3B;AACA,eAAOT,KAAK,CAACiB,OAAN,CAAc;AAACC,UAAAA,aAAa,EAAEP,OAAO,CAACO,aAAxB;AAAuCC,UAAAA,KAAK,EAAER,OAAO,CAACQ;AAAtD,SAAd,EAA4EC,IAA5E,CAAkFC,GAAG,IAAI;AAC9FN,UAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ,EAAkBK,GAAlB;;AACA,cAAGA,GAAG,CAACC,IAAP,EAAa;AAEXpB,YAAAA,sBAAsB,CAACmB,GAAG,CAACC,IAAJ,CAASC,KAAV,CAAtB;AACAX,YAAAA,YAAY,CAACY,OAAb,CAAqB,gBAArB,EAAuCX,IAAI,CAACY,SAAL,CAAe,EACpD,GAAGd,OADiD;AACxCY,cAAAA,KAAK,EAAEF,GAAG,CAACC,IAAJ,CAASC;AADwB,aAAf,CAAvC;AAGAhB,YAAAA,eAAe,CAACmB,MAAhB,CAAuBC,aAAvB,GAAuCN,GAAG,CAACC,IAAJ,CAASC,KAAhD;AACA,mBAAOtB,KAAK,CAACM,eAAD,CAAZ;AACD,WARD,MAQO;AACLqB,YAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAsB,QAAtB;AACAlB,YAAAA,YAAY,CAACmB,UAAb,CAAwB,gBAAxB;AACD;AACF,SAdM,CAAP;AAeD,OAnBI,MAoBA1B,OAAO,GAAGD,KAAK,CAACE,QAAN,CAAegB,IAAf,CAAoBjB,OAA9B;AACL,UAAI,OAAOA,OAAP,KAAmB,QAAvB,EAAiCN,KAAK,CAACK,KAAN,CAAYC,OAAZ;AAEjC,aAAO2B,OAAO,CAACC,MAAR,CAAe7B,KAAf,CAAP;AACD;AACF;AACF","sourcesContent":["import { toast } from \"react-toastify\";\nimport users from \"constants/api/users\";\n\nimport axios, { setAuthorizationHeader } from \"./index\";\n\nexport default function errorHandler(error) {\n  if (error) {\n    let message;\n    if (error.response) {\n      // console.log(error.response.status)\n      const originalRequest = error.config\n      if (error.response.status === 500)\n        message = \"Something went terribly wrong\";\n      else if (error.response.status == 403 && !originalRequest._retry) {\n        originalRequest._retry = true\n        const session = localStorage['BWAMICRO:token'] ? JSON.parse(localStorage['BWAMICRO:token']) : null\n        console.log(error.response.status)\n        return users.refresh({refresh_token: session.refresh_token, email: session.email}).then( res => {\n          console.log(\"ok\", res)\n          if(res.data) {\n         \n            setAuthorizationHeader(res.data.token)\n            localStorage.setItem(\"BWAMICRO:token\", JSON.stringify({\n              ...session, token: res.data.token\n            }))\n            originalRequest.header.authorization = res.data.token\n            return axios(originalRequest)\n          } else {\n            window.location.href =\"/login\"\n            localStorage.removeItem(\"BWAMICRO:token\")\n          }\n        })\n      }\n      else message = error.response.data.message;\n      if (typeof message === \"string\") toast.error(message);\n\n      return Promise.reject(error);\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}